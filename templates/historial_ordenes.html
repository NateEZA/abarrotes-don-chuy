{% extends "base.html" %}
{% block titulo %}Historial de Compras - Abarrotes Don Chuy{% endblock %}
{% block contenido %}
<h1 style="color: #2c3e50; margin-bottom: 2rem;">üì¶ Historial de Compras</h1>
{% if ordenes %}
<div style="display: grid; gap: 1.5rem;">
    {% for orden in ordenes %}
    <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #e0e0e0;">
            <div>
                <h3 style="color: #2c3e50; margin-bottom: 0.5rem;">Orden #{{ orden.id }}</h3>
                <p style="color: #7f8c8d; margin: 0;">{{ orden.fecha_creacion.strftime('%d de %B, %Y - %H:%M') }}</p>
            </div>
            <div style="text-align: right;">
                <div style="font-size: 1.8rem; color: #27ae60; font-weight: bold; margin-bottom: 0.5rem;">${{ "%.2f"|format(orden.total) }}</div>
           <span class="estado-badge estado-{{ orden.estado|lower }}">
    {{ orden.estado }}
</span>
            </div>
        </div>

        <div style="margin-bottom: 1.5rem;">
            <h4 style="color: #2c3e50; margin-bottom: 1rem;">Productos:</h4>
            {% for item in orden.items %}
            <div style="display: flex; align-items: center; gap: 1rem; padding: 0.75rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 0.5rem;">
                <img src="{{ url_for('static', filename='uploads/' + item.producto.imagen) }}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px;">
                <div style="flex: 1;">
                    <strong style="color: #2c3e50;">{{ item.producto.nombre }}</strong>
                    <div style="color: #7f8c8d; font-size: 0.9rem;">Cantidad: {{ item.cantidad }} √ó ${{ "%.2f"|format(item.precio) }}</div>
                </div>
                <div style="font-weight: bold; color: #27ae60;">${{ "%.2f"|format(item.cantidad * item.precio) }}</div>
            </div>
            {% endfor %}
        </div>

        {% if orden.direccion_envio %}
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; padding-top: 1rem; border-top: 2px solid #e0e0e0;">
            <div>
                <h4 style="color: #2c3e50; margin-bottom: 0.5rem;">üìç Direcci√≥n de Env√≠o:</h4>
                <p style="color: #555; margin: 0; line-height: 1.6;">
                    {{ orden.direccion_envio.calle }}<br>
                    {{ orden.direccion_envio.ciudad }}, {{ orden.direccion_envio.estado }}<br>
                    {{ orden.direccion_envio.codigo_postal }}, {{ orden.direccion_envio.pais }}
                </p>
            </div>
            {% if orden.metodo_pago %}
            <div>
                <h4 style="color: #2c3e50; margin-bottom: 0.5rem;">üí≥ M√©todo de Pago:</h4>
                <p style="color: #555; margin: 0; line-height: 1.6;">
                    ****{{ orden.metodo_pago.ultimos4_tarjeta }}<br>
                    {{ orden.metodo_pago.titular_tarjeta }}
                </p>
            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% else %}
<div style="background: white; padding: 3rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center;">
    <div style="font-size: 4rem; margin-bottom: 1rem;">üì¶</div>
    <h2 style="color: #2c3e50; margin-bottom: 1rem;">No tienes compras a√∫n</h2>
    <p style="color: #7f8c8d; margin-bottom: 2rem;">¬°Explora nuestro cat√°logo!</p>
    <a href="{{ url_for('index') }}" class="btn btn-primario">Ver Productos</a>
</div>
{% endif %}
{% endblock %}