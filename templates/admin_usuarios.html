{% extends "base.html" %}

{% block titulo %}Gesti√≥n de Usuarios - Abarrotes Don Chuy{% endblock %}

{% block contenido %}
<h1 style="color: #2c3e50; margin-bottom: 2rem;">üë• Gesti√≥n de Usuarios</h1>

{% if es_super_admin %}
<div style="background: #fff3cd; border: 1px solid #ffeeba; color: #856404; padding: 1rem; border-radius: 8px; margin-bottom: 2rem;">
    <strong>üëë Modo Super Admin:</strong> Como Nate, puedes ver las contrase√±as hasheadas y palabras clave de todos los usuarios.
</div>
{% endif %}

<div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
    <table class="tabla">
        <thead>
            <tr>
                <th>ID</th>
                <th>Usuario</th>
                <th>Email</th>
                <th>Rol</th>
                {% if es_super_admin %}
                <th>Palabra Clave</th>
                <th>Hash Contrase√±a</th>
                {% endif %}
                <th>Registrado</th>
                <th>Acci√≥n</th>
            </tr>
        </thead>
        <tbody>
            {% for usuario in usuarios %}
            <tr>
                <td>{{ usuario.id }}</td>
                <td>{{ usuario.nombre_usuario }}</td>
                <td>{{ usuario.email }}</td>
                <td>
                    <span style="background: {% if usuario.rol == 'Admin' %}#3498db{% elif usuario.rol == 'Vendedor' %}#f39c12{% else %}#27ae60{% endif %}; color: white; padding: 0.25rem 0.75rem; border-radius: 20px;">
                        {{ usuario.rol }}
                    </span>
                </td>
                {% if es_super_admin %}
                <td style="color: #e74c3c; font-weight: 600;">{{ usuario.palabra_clave }}</td>
                <td style="font-family: monospace; font-size: 0.75rem; color: #7f8c8d; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="{{ usuario.hash_contrasena }}">
                    {{ usuario.hash_contrasena[:30] }}...
                </td>
                {% endif %}
                <td>{{ usuario.fecha_creacion.strftime('%d/%m/%Y') }}</td>
                <td>
                    {% if usuario.nombre_usuario != 'Nate' %}
                    <form method="POST" action="{{ url_for('eliminar_usuario', id_usuario=usuario.id) }}" style="display: inline;">
                        <button type="submit" class="btn btn-peligro" style="padding: 0.5rem 1rem;" onclick="return confirm('¬øEst√°s seguro? El historial de ventas y rese√±as se mantendr√°.')">
                            Eliminar
                        </button>
                    </form>
                    {% else %}
                    <span style="color: #7f8c8d; font-style: italic;">Super Admin</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div style="margin-top: 2rem;">
    <a href="{{ url_for('panel_admin') }}" class="btn btn-secundario">‚Üê Volver al Panel</a>
</div>
{% endblock %}